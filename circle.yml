machine:
    environment:
        # We need to set this variable to let Anaconda take precedence
        PATH: "$HOME/miniconda/bin:$PATH"
        PYTHON_VERSION: 3.5
        MINICONDA: $HOME/miniconda
        MINICONDA_URL: "https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh"

dependencies:
    override:
        - cd ~
        - rm -rf ~/.pyenv
        - rm -rf ~/virtualenvs
        # Make sure we're running the Miniconda Python and pip
        - which python
        - which pip
        - bash ci/install-miniconda.sh
        - conda create -n testenv --yes pip python=$PYTHON_VERSION
        - source activate testenv
        - conda install --file ci/requirements-conda.txt
        - pip install -r ci/requirements-pip.txt
        - conda list
        # Package and install
        - python setup.py sdist --formats=gztar
        - pip install dist/*.tar.gz
test:
    override:
        - make pep8
        - make coverage
